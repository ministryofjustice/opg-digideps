cache_effective_user squid
cache_effective_group squid
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8             # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
acl localnet src 172.16.0.0/12          # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16         # RFC 1918 local private network (LAN)
acl localnet src fc00::/7               # RFC 4193 local private network range
acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines

acl url_list dstdomain "/etc/squid/http_domain_allow_list.txt" # List of allowed domains
# SSL server name matching for HTTPS CONNECT requests
acl allowed_https_sites ssl::server_name "/etc/squid/domain_allow_list.txt"

acl CONNECT method CONNECT

# SSL and Safe ports
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

# Access control lists
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny CONNECT !allowed_https_sites
http_access allow localhost manager
http_access allow localhost
http_access deny to_localhost
http_access deny to_linklocal
http_access allow url_list
http_access deny !url_list
# http_access allow allowed_https_sites
http_access allow localnet

http_access deny all

# Squid normally listens to port 3128
# http_port 3128
# HTTPS port configuration
http_port 3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/ssl_cert/myca.pem key=/usr/local/squid/ssl_cert/myca.pem
always_direct allow all

# SSL bump settings
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

# SSL bump settings
ssl_bump peek step1
ssl_bump stare step2
ssl_bump bump all

sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/spool/squid/ssl_db -M 4MB
sslcrtd_children 5 startup=1 idle=1


# Access logs
access_log /dev/stdout squid

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

pid_filename /var/run/squid/squid.pid
