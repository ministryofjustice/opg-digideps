{% extends '@App/Layouts/application.html.twig' %}

{% trans_default_domain "admin" %}
{% set page = 'uploadPA' %}

{% set navSection = 'users' %}

{% block htmlTitle %}{{ (page ~ '.htmlTitle') | trans }}{% endblock %}
{% block pageTitle %}{{ (page ~ '.pageTitle') | trans }}{% endblock %}
{% block supportTitleTop %}{{ (page ~ '.supportTitle') | trans }}{% endblock %}

{% block helpline %}{% endblock %}

{% block pageContent %}


<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">{{ (page ~ '.heading') | trans }}</h2>
        {{ form_errors(uploadForm) }}

        {{ form_start(uploadForm, {attr: {'data-module': 'csv-upload-progress', novalidate: 'novalidate' }}) }}

        <div class="opg-alert opg-alert--error hidden" data-js="upload-error">
            <div class="opg-alert__message">
                {{ (page ~ '.uploadError') | trans }}
            </div>
        </div>

        {{ form_input(uploadForm.file, 'uploadPA.upload', {
        'inputClass': 'no-border'
        }) }}

        {{ form_submit(uploadForm.upload, 'uploadPA.submit') }}

        <div class="govuk-form-group">
            <p class="hidden" data-js="upload-explanation">{{ (page ~ '.uploading') | trans | nl2br }}</p>

            <progress value="0" min="0" max="1" class="hidden"></progress>
        </div>

        {{ form_end(uploadForm) }}
    </div>
    {% if fileUploadedInfo['date'] != null %}
    <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">Process S3 file</h2>
        <p class="govuk-!-margin-0 govuk-!-margin-bottom-1">S3 Filename: {{ fileUploadedInfo['fileName'] }}</p>
        <span class="govuk-hint">Time uploaded: {{ fileUploadedInfo['date']|date('d/m/Y - H:i:s A') }}</span>
        {{ form_errors(processForm) }}

        {{ form_start(processForm) }}

        <div class="opg-alert opg-alert--error hidden" data-js="upload-error">
            <div class="opg-alert__message">
                {{ (page ~ '.processError') | trans }}
            </div>
        </div>

        {{ form_submit(processForm.process, 'uploadPA.process') }}

        {{ form_end(processForm) }}
    </div>
    {% endif %}
</div>

{% endblock %}
