{% extends '@App/Layouts/application.html.twig' %}

{% trans_default_domain "admin" %}
{% set page = 'uploadUsers' %}

{% set navSection = 'users' %}

{% block htmlTitle %}{{ (page ~ '.htmlTitle') | trans }}{% endblock %}
{% block pageTitle %}{{ (page ~ '.pageTitle') | trans }}{% endblock %}
{% block supportTitleTop %}{{ (page ~ '.supportTitle') | trans }}{% endblock %}

{% block helpline %}{% endblock %}

{% block pageContent %}

    {% if nOfChunks %}

<p class="govuk-body">
    {{ (page ~ '.uploading.beforeMarkupText') | trans }}<br>
    {{ (page ~ '.uploading.afterMarkupText') | trans }}
</p>

<progress id="uploadProgress" value="0" max="{{ nOfChunks + 1 }}" data-path-pre-registration-delete-ajax="{{ path('pre_registration_delete_ajax') }}" data-path-pre-registration-add-ajax="{{ path('pre_registration_add_ajax') }}" data-path-pre-registration-upload="{{ path('pre_registration_upload') }}" class="js-upload-progress">
    {% else %}
        <div class="data">
            <span class="data-item govuk-!-font-size-80 govuk-!-font-weight-bold">{{ currentRecords }}</span>
            <span class="data-item govuk-!-font-size-19 govuk-!-font-weight-bold">{{ (page ~ '.usersInTheDB') | trans }}</span>
        </div>


        <h2 class="govuk-heading-m">{{ (page ~ '.heading') | trans }}</h2>

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
                {{ form_start(uploadForm, {attr: {novalidate: 'novalidate' }}) }}

                {{ form_input(uploadForm.file, '', {
                    'labelText': 'Select CSV file exported from Sirius',
                    'hintText': 'Max upload size is ' ~ maxUploadSize,
                    'inputClass': 'no-border'
                }) }}

                {{ form_submit(uploadForm.upload, '', {'labelText': 'Upload Lay users'}) }}

                {{ form_end(uploadForm) }}
            </div>
            <div class="govuk-grid-column-one-half">
                <h2 class="govuk-heading-m">Process S3 file</h2>
                <p class="govuk-!-margin-0 govuk-!-margin-bottom-1">S3 Filename: {{ fileUploadedInfo['fileName'] }}</p>
                <span class="govuk-hint">Time uploaded: {{ fileUploadedInfo['date'] }}</span>
                {{ form_errors(processForm) }}

                {{ form_start(processForm) }}

                <div class="opg-alert opg-alert--error hidden" data-js="upload-error">
                    <div class="opg-alert__message">
                        {{ (page ~ '.processError') | trans }}
                    </div>
                </div>

                {{ form_submit(processForm.process, 'uploadPA.process') }}

                {{ form_end(processForm) }}
            </div>
        </div>
    {% endif %}
    {% endblock %}
