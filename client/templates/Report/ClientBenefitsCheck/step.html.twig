{% extends '@App/Layouts/application.html.twig' %}

{% import '@App/Macros/macros.html.twig' as macros %}

{% set translationDomain = "report-client-benefits-check" %}
{% trans_default_domain translationDomain %}

{% set transOptions = {
    '%client%': report.client.firstname | e,
} %}

{% block htmlTitle %}{{ 'common.htmlTitle' | trans(transOptions, translationDomain) }}{% endblock %}
{% block supportTitleTop %}{{ 'stepPage.supportTitle' | trans(transOptions, translationDomain) }}{% endblock %}
{% block pageTitle %}{{ ('stepPage.pageTitle.' ~ step ~ '.mainTitle') | trans(transOptions, translationDomain) }}{% endblock %}

{% block linkBack %}
    {{ macros.linkBackStep(backLink, 'back' | trans({}, 'common')) }}
{% endblock %}

{% block supportTitleBottom %}
    {% if step != 1 %}
        {{ ('stepPage.pageTitle.'  ~ step ~ '.subTitle') | trans(transOptions, translationDomain) }}
    {% endif %}
{% endblock %}

{% block breadcrumbs %}{{ macros.breadcrumbs(report) }}{% endblock %}

{% block pageContent %}
    {{ form_start(form, { attr: {novalidate: 'novalidate' } }) }}

    {% if step == 1 %}
        {% set conditionalDateChecked %}
            {{ form_known_date(form.dateLastCheckedEntitlement, 'form.whenLastChecked', {
                'hintText' : 'form.whenLastChecked.dateCheckedHint' | trans(transOptions, translationDomain),
                'showDay' : 'false'
            }) }}
        {% endset %}

        {% set conditionalNeverChecked %}
            {{ form_input(form.neverCheckedExplanation, 'form.whenLastChecked', {
                'hintText' : 'form.whenLastChecked.neverCheckedHint' | trans(transOptions, translationDomain),
                'labelText' : ' '
            }) }}
        {% endset %}

        {{ form_checkbox_group(form.whenLastCheckedEntitlement, 'form.clientBenefitsCheck', {
            'useFormGroup': false,
            'labelText': ('form.clientBenefitsCheck.label') | trans(transOptions, translationDomain),
            label: {
                isPageHeading: true,
                caption: 'stepPage.supportTitle' | trans
            },
            'items': [
                {
                    conditional: conditionalDateChecked
                },
                {},
                {
                    conditional: conditionalNeverChecked
                }
            ]
        }) }}

        {{ macros.saveAndContinueButton(form.save) }}
    {% endif %}

    {% if step == 2 %}
        {% set conditionalIncomeDontKnowChecked %}
            {{ form_input(form.dontKnowIncomeExplanation, 'form.incomeOnClientsBehalf', {
                'hintText' : 'form.incomeOnClientsBehalf.dontKnowHint' | trans(transOptions, translationDomain),
                'labelText' : 'form.incomeOnClientsBehalf.dontKnowLabel' | trans(transOptions, translationDomain)
            }) }}
        {% endset %}

        {{ form_checkbox_group(form.doOthersReceiveIncomeOnClientsBehalf, 'form.incomeOnClientsBehalf', {
            'useFormGroup': false,
            'labelText': ('form.clientBenefitsCheck.label') | trans(transOptions, translationDomain),
            label: {
                isPageHeading: true,
                caption: 'stepPage.supportTitle' | trans
            },
            'items': [
                {},
                {},
                {
                    conditional: conditionalIncomeDontKnowChecked
                }
            ]
        }) }}

        {{ macros.saveAndContinueButton(form.save) }}
    {% endif %}

    {% if step == 3 %}
        {% for typeOfIncomeReceivedOnClientsBehalf in form.typesOfIncomeReceivedOnClientsBehalf %}
            <fieldset class="add-another__item">
                {{ form_input(typeOfIncomeReceivedOnClientsBehalf.incomeType, '', {
                    'hintText' : '',
                    'label' : { 'text': 'form.incomeDetails.incomeTypeLabel' | trans(transOptions, translationDomain) }
                }) }}

                {{ form_input(typeOfIncomeReceivedOnClientsBehalf.amount, '', {
                    'hintText' : '',
                    'label' : { 'text': 'form.incomeDetails.amountLabel' | trans(transOptions, translationDomain) },
                    'inputPrefix' : 'Â£'
                }) }}

                {{ form_checkbox(typeOfIncomeReceivedOnClientsBehalf.amountDontKnow, 'form.incomeDetails', {
                    'labelText': ('form.incomeDetails.dontKnowCheckboxLabel') | trans(transOptions, translationDomain)
                }) }}
            </fieldset>

            <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
        {% endfor %}

        {{ macros.saveAndContinueButton(form.save) }}
        {{ macros.addAnotherSaveButton(form.addAnother, 'addAnother', 'govuk-button--secondary') }}
    {% endif %}

    {{ form_end(form) }}

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="{{ 'javascripts/clientBenefitsCheckForm.js'| assetUrl }}"></script>
{% endblock %}
