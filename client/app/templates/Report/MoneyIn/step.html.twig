{% extends '@App/Layouts/application.html.twig' %}

{% import '@App/Macros/macros.html.twig' as macros %}

{% set translationDomain = "report-money-transaction" %}
{% trans_default_domain translationDomain %}

{% set clientTransOptions = {'%client%': report.client.firstname | striptags } %}
{% set category = transaction.category %}
{% set transOptions = clientTransOptions | merge({
    '%moneyTransfersPath%': path('money_transfers', {reportId: report.id})
}) %}

{% block htmlTitle %}{{ 'stepPage.moneyIn.htmlTitle' | trans(transOptions) }}{% endblock %}

{% set categoryString = ('form.category.entries.' ~ transaction.category ~ '.label') | trans(clientTransOptions) %}
{% set categoryString2ndStep = ('form.category.entries.' ~ transaction.category ~ '.label2ndStep') | trans(clientTransOptions) %}

{% block pageHeader %}
    {% if step == 2 %}
        {{ parent() }}
        {% block pageTitle %}{% endblock %}
        {% set pageTitle = 'stepPage.moneyIn.pageTitle' | trans(transOptions)  ~ ': ' ~ ('.entries.' in categoryString2ndStep ? (categoryString | lcfirst) : categoryString2ndStep) %}
    {% endif %}
{% endblock %}


{% block supportTitleTop %}
    {{ 'stepPage.moneyIn.supportTitle' | trans }}
{% endblock %}

{% block linkBack %}
    {{ macros.linkBackStep(backLink, 'back' | trans({}, 'common')) }}
{% endblock %}

{% block pageContent %}

    {{ form_start(form, {attr: {id: 'account-form', novalidate: 'novalidate' } }) }}

    {% if step == 1 %}
        <div id="form-group-account_category" class="govuk-form-group push--top {% if not form.category.vars.valid %}govuk-form-group--error{% endif %}">
            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--xl">
                    <span class="govuk-caption-xl">{{ 'stepPage.moneyIn.supportTitle'|trans }}</span>
                    <h1 class="govuk-fieldset__heading">
                        {{ 'stepPage.moneyIn.pageTitle' | trans(transOptions) }}
                    </h1>
                </legend>

            {% for group, categories in categoriesGrouped %}
                <div class="govuk-label--s govuk-hint">
                    {{ ('form.group.entries.' ~ group) | trans(clientTransOptions, translationDomain) }}
                </div>

                {% for category in categories %}
                    {% for el in form.category %}
                        {% if el.vars.value == category %}
                            {{ form_checkbox(el, '', {
                                'useFormGroup': false,
                                'labelText': ('form.category.entries.' ~ category ~ '.label') | trans(clientTransOptions, translationDomain)
                            }) }}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            {% endfor %}
            </fieldset>
        </div>
    {% endif %}

    {% if step == 2 %}
        {{ form_input(form.description, 'form.description.' ~ (form.description.vars.required ? 'mandatory' : 'optional'), {
            'labelParameters' : transOptions
        }) }}

        {{ form_input(form.amount, 'form.amount', {
            'inputPrefix' : 'Â£',
            'inputClass' : 'govuk-!-width-one-quarter js-format-currency',
            'formGroupClass': ' form-group-value'
        }) }}

        {% if report.bankAccounts is not empty and report.canLinkToBankAccounts %}
            {{ form_select(form.bankAccountId, 'form.bankAccount', {'labelText': form.bankAccountId.vars.label | trans}) }}
        {% endif %}

        {% if form.addAnother %}
            {{ form_add_another({
                'addAnother': form.addAnother,
                'thingTranslationKey': 'form.thing',
                'translationDomain': 'report-money-in'
            }) }}
        {% endif %}
    {% endif %}

    {{ macros.saveAndContinueButton(form.save) }}

    {{ form_end(form) }}

{% endblock %}
