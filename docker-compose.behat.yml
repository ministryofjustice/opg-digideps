services:
  integration-tests:
    build:
      dockerfile: api/docker/app/Dockerfile
      context: .
    depends_on:
      - localstack
      - mock-sirius-integration
    volumes:
      - ./api/app/tests/Behat:/var/www/tests/Behat
      - ./api/app/src:/var/www/src
      - ./api/app/tests/Behat/snapshots:/tmp/html
    env_file:
      - ./api/app/api.env
      - ./api/app/tests/Behat/test.env
    environment:
      APP_ENV: local

  frontend-app:
    environment:
      APP_ENV: local
    env_file:
      - .env

  admin-app:
    environment:
      APP_ENV: local
    env_file:
      - .env

  synchronisation:
    restart: "no"
    entrypoint: ["echo", "Service sync disabled"]

  node-js:
    image: opg-digideps-resources
    build:
      context: .
      dockerfile: ./client/docker/resources/Dockerfile
      target: testing
    environment:
      NODE_ENV: production

  zap-admin:
    image: owasp/zap2docker-stable
    volumes:
      - "./zap/:/zap/wrk/"
    command: bash -c "zap.sh -cmd -addonupdate -addoninstall pscanrules -addoninstall pscanrulesBeta -addoninstall pscanrulesAlpha -addoninstall ascanrules -addoninstall ascanrulesBeta -addoninstall ascanrulesAlpha; zap.sh -cmd -autorun /zap/wrk/zap-digideps-admin.yaml"

  zap-front:
    image: owasp/zap2docker-stable
    volumes:
      - "./zap/:/zap/wrk/"
    command: bash -c "zap.sh -cmd -addonupdate -addoninstall pscanrules -addoninstall pscanrulesBeta -addoninstall pscanrulesAlpha -addoninstall ascanrules -addoninstall ascanrulesBeta -addoninstall ascanrulesAlpha; zap.sh -cmd -autorun /zap/wrk/zap-digideps-front.yaml"
