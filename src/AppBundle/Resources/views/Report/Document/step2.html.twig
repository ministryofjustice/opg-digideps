{% extends 'AppBundle:Layouts:application.html.twig' %}

{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% set translationDomain = "report-documents" %}
{% set page = "attachPage" %}

{% trans_default_domain translationDomain %}

{# Page Titles #}
{% block htmlTitle %}{{ 'htmlTitle' | trans }}{% endblock %}
{% block pageTitle %}{{ (page ~ '.pageTitle') | trans }}{% endblock %}
{% block pageTitleClass %}heading-large{% endblock %}

{% block supportTitleTop %}
    <span class="heading-secondary">{{ 'pageTitle' | trans }}</span>
{% endblock %}

{% block linkBack %}
    {{ macros.linkBackStep(backLink, 'stepPage.backLink' | trans) }}
{% endblock %}

{% block pageContent %}

    <h2 class="heading-medium">{{ (page ~ '.selectHeading') | trans }}</h2>

    <div class="text">
        <p>{{ (page ~ '.selectHelp') | trans }}</p>
        <p>{{ (page ~ '.selectHint') | trans }}</p>
    </div>

    {{ form_start(form, {'attr': {'id': 'upload_form', 'class': 'push-double--bottom'}}) }}
    {{ form_input(form.file,'form.file', {
        'labelText':  '' | trans ,
        'labelClass': 'visually-hidden',
        'inputClass': 'no-border behat-link-choose-file' })
    }}

    <h2 class="heading-medium flush--top">{{ (page ~ '.uploadHeading') | trans }}</h2>

    <div class="alert-info panel panel-border-narrow js-hidden">
        <span class="icon icon-information"></span>
        <div class="alert-message">
            <p>{{ (page ~ '.uploadHint') | trans }}</p>
        </div>
    </div>

    {{ form_submit(form.save, '', {'buttonClass': 'behat-link-attach-file js-uploading', 'labelText': 'form.submitButton' | trans}) }}

    <div class="alert-info panel panel-border-narrow push-half--top hidden" id="upload-progress">
        <span class="icon icon-loader"></span>
        <div class="alert-message">
            <p>{{ (page ~ '.pleaseWait') | trans }}</p>
            <p>{{ (page ~ '.uploadHint') | trans }}</p>
        </div>
    </div>

    {{ form_end(form) }}


    {#<h2 class="heading-medium">Uploading progress</h2>#}
    {#<p>Please wait while your document is being uploaded.</p>#}
    {#<progress max="100" value="24" style="width: 50%"></progress>#}
    {% if report.isSubmitted %}
        {% include 'AppBundle:Report/Document:_list_submitted.html.twig'  with {
        'documents': report.submittedDocuments,
        'translationDomain': translationDomain,
        'page' : page,
        } %}
        <a href="{{ nextLink }}" class="button push--top">{{ 'continue' | trans({}, 'common' ) }}</a>
    {% elseif report.documents | length > 0 %}
        {% include 'AppBundle:Report/Document:_list.html.twig'  with {
        'translationDomain': translationDomain,
        'page' : page
        } %}
        <a href="{{ nextLink }}" class="button push--top">{{ 'continue' | trans({}, 'common' ) }}</a>
    {% endif %}

    <script>
        $(document).ready(function () {
            $('#upload_form').submit(function (e) {
                e.preventDefault();
                var fileElement = $('#report_document_upload_file');

                //check whether browser fully supports all File API
                if (window.File && window.FileReader && window.FileList && window.Blob && fileElement[0].files.length > 0) {
                    var fsize = fileElement[0].files[0].size;
                    if (fsize > {{ 15 * 1024 * 1024 }} ) {
                        window.location = '{{ path('report_documents', {'reportId': report.id, 'error': 'tooBig'}) }}';
                        return;
                    }
                }

                this.submit();
            });
        });
    </script>


{% endblock %}
