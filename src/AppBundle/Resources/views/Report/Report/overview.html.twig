{% extends 'AppBundle:Layouts:application_new.html.twig' %}

{% set translationDomain = "overview" %}
{% trans_default_domain translationDomain %}

{% set is102 = report.type == constant('AppBundle\\Entity\\Report\\Report::TYPE_102') %}
{% set is103 = report.type == constant('AppBundle\\Entity\\Report\\Report::TYPE_103') %}
{% set is104 = report.type == constant('AppBundle\\Entity\\Report\\Report::TYPE_104') %}

{% block htmlTitle %}{{ 'page.htmlTitle' | trans }}{% endblock %}
{% block pageTitle %}{% endblock %}

{% block pageContent %}

    {% block pageHeader %}
        {% include 'AppBundle:Report/Report:_header.html.twig' %}
    {% endblock %}

    <div class="grid-row">
        <div class="column-one-half">
            <ul>
                <li>{{ 'reportingPeriod' | trans() }}:
                    <span class="bold-small">{{ report.startDate | date(" d F Y") }} to {{ report.endDate | date(" d F Y") }}</span>
                </li>
                <li>{{ 'dueDate' | trans() }}:
                    <span class="bold-small">{{ report.dueDate | date(" d F Y") }}</span>
                </li>
                <li>Report status:
                    <span class="bold-small">{{ reportStatus.status | trans() }}</span>
                </li>
            </ul>
        </div>

        <div class="column-one-half">
            <a class="button right" href="{{ path('report_review', {'reportId': report.id}) }}">Review report</a>
        </div>
    </div>

    <ul id="overview-sections" class="overview-sections">

        <li id="planning-section" class="overview-section">
            <h2 class="heading">{{ 'heading.decisionsContacts' | trans() }}</h2>
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'decisions',
                report: report,
                description: true,
                state: reportStatus.decisionsState,
                nOfRecords: report.decisions | length,
                list: true
            } %}
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'contacts',
                report: report,
                description: true,
                list: true,
                info: true,
                state: reportStatus.contactsState,
                nOfRecords: report.contacts | length,
            } %}
        </li>

        <li id="welfare-section" class="overview-section">
            <h2 class="heading">{{ 'heading.healthAndWelfare' | trans() }}</h2>
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'visits_care',
                report: report,
                info: true,
                description: true,
                state: reportStatus.visitsCareState
            } %}
        </li>

        {% if is102 or is103 %}
            <li id="finances-section" class="overview-section">
                <h2 class="heading push-half--bottom">{{ 'heading.propFinance' | trans() }}</h2>
                {% if report.isDue() and not reportStatus.balanceMatches %}
                    {% include 'AppBundle:Components/Alerts:_notification.html.twig' with {
                        alertType: 'notice',
                        message: 'balance.notBalancedWarning' | trans({
                            '%detailsLink%': path('balance', {'reportId': report.id}) })
                    } %}
                {% endif %}

                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'deputy_expenses',
                    report: report,
                    state: reportStatus.expensesState,
                    nOfRecords: report.expenses | length,
                    linkToSubSection: path('deputy_expenses', {'reportId': report.id}),
                    description: true
                } %}

                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'bank_accounts',
                    report: report,
                    state: reportStatus.bankAccountsState,
                    nOfRecords: report.bankAccounts | length,
                    warning: true,
                    description: true
                } %}
                {% if is102 %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'money_transfers',
                        report: report,
                        state: reportStatus.moneyTransferState,
                        nOfRecords: report.moneyTransfers | length,
                        warning: true,
                        description: true
                    } %}
                    {% endif %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_in',
                    report: report,
                    state: reportStatus.moneyInState,
                    nOfRecords: report.transactionsIn | length,
                    warning: true,
                    description: true
                } %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'money_out',
                    report: report,
                    state: reportStatus.moneyOutState,
                    nOfRecords: report.transactionsOut | length,
                    warning: true,
                    description: true
                } %}
                {# show balance section only for editing, when an explanation is given #}
                {% if report.balanceMismatchExplanation %}
                    {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                        transDomain: translationDomain,
                        subSection: 'balance',
                        report: report,
                        state: reportStatus.balanceState,
                        warning: true,
                        description: true
                    } %}
                {% endif %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'assets',
                    report: report,
                    state: reportStatus.assetsState,
                    nOfRecords: report.assets | length,
                    list: true,
                    description: true
                } %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'debts',
                report: report,
                state: reportStatus.debtsState,
                nOfRecords: report.debtsWithValidAmount | length,
                list: true,
                description: true
                } %}
            </li>
        {% endif %}


        <li id="report-submit-section" class="overview-section">
            <h2 class="heading">{{ 'heading.other' | trans() }}</h2>
            {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                transDomain: translationDomain,
                subSection: 'actions',
                report: report,
                description: true,
                state: reportStatus.actionsState,
                list: true
            } %}

            {% if reportStatus.isReadyToSubmit and report.isDue %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'report_add_further_info',
                    report: report,
                    description: false,
                    state: "not-started",
                    status: "Not started"
                } %}
            {%  else %}
                {% include 'AppBundle:Report/Report:_subsection.html.twig' with {
                    transDomain: translationDomain,
                    subSection: 'report_add_further_info',
                    report: report,
                    description: false,
                    state: "not-started",
                    status: "Not started",
                    disableedit: true
                } %}
            {%  endif %}
        </li>
    </ul>

    {% if report.isDue == false and reportStatus.isReadyToSubmit == false %}
        {% include 'AppBundle:Components/Alerts:_notification.html.twig' with {
            alertType: 'notice',
            message: 'submitWhenReady' | trans()
        } %}
    {% endif %}

    {% if report.isDue == true %}
        {% set endDate = report.getEndDate() | date(" d F Y")  %}
        {% set transOptions = {'%date%': endDate} %}
        {% include 'AppBundle:Components/Alerts:_notification.html.twig' with {
            alertType: 'notice',
            message: 'warningNotDue' | trans(transOptions)
        } %}
    {% endif %}

{% endblock %}
