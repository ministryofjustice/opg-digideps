version: "3.2"

services:
  test:
    build: ./api
    depends_on:
      - localstack
      - mock-sirius-integration
    volumes:
      - ./api/tests/Behat:/var/www/tests/Behat
      - ./api/src:/var/www/src
      - ./api/tests/Behat/snapshots:/tmp/html
      - ./api/vendor:/var/www/vendor
    env_file:
      - ./api/api.env
      - ./api/tests/Behat/test.env
      - ./api/tests/Behat/.env
    environment:
      APP_ENV: dev

  npm:
    image: node:18.14.2-alpine
    working_dir: /app
    volumes:
      - ./client/:/app
    entrypoint: npm
    environment:
      NODE_ENV: production

  composerapi:
    image: composer:2.2.12
    volumes:
      - ./api/:/app

  composerfront:
    image: composer:2.2.12
    volumes:
      - ./client/:/app

  frontend:
    environment:
      APP_ENV: dev
    env_file:
      - .env

  admin:
    environment:
      APP_ENV: dev
    env_file:
      - .env

  synchronisation:
    restart: "no"
    entrypoint: ["echo", "Service sync disabled"]
