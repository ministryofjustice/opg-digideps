version: "3.2"

services:
  integration-tests:
    build:
      context: ./api
    depends_on:
      - localstack
      - mock-sirius-integration
    volumes:
      - ./api/tests/Behat:/var/www/tests/Behat
      - ./api/src:/var/www/src
      - ./api/tests/Behat/snapshots:/tmp/html
      - ./api/vendor:/var/www/vendor
    env_file:
      - ./api/api.env
      - ./api/tests/Behat/test.env
    environment:
      APP_ENV: dev

  frontend-app:
    environment:
      APP_ENV: dev
    env_file:
      - .env

  admin-app:
    environment:
      APP_ENV: dev
    env_file:
      - .env

  synchronisation:
    restart: "no"
    entrypoint: ["echo", "Service sync disabled"]

  node-js:
    image: opg-digideps-resources
    build:
      context: .
      dockerfile: ./client/docker/resources/Dockerfile
      target: testing
    environment:
      NODE_ENV: production
